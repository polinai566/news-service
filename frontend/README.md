# Frontend приложения для новостного API

React-приложение, разработанное с использованием Vite, является клиентской частью для новостного API, написанного на FastAPI.

## Технологический стек

- **React** 19.2.0
- **Vite** 7.2.4
- **React Router DOM** 7.9.6
- **Axios** 1.13.2
- **Node.js** 18+

## Установка и запуск

### Предварительные требования

- Node.js версии 18 или выше
- Запущенный backend API на `http://localhost:8000`

### Инструкция по установке

1. Перейдите в директорию `frontend`:
   ```bash
   cd frontend
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Запустите приложение в режиме разработки:
   ```bash
   npm run dev
   ```

   Приложение будет доступно по адресу `http://localhost:5173` (или другому порту, указанному в консоли).

### Дополнительные команды

- **Сборка для production**:
  ```bash
  npm run build
  ```

- **Предпросмотр production сборки**:
  ```bash
  npm run preview
  ```

- **Проверка кода линтером**:
  ```bash
  npm run lint
  ```

## Структура приложения

### Доступные страницы

| Маршрут | Описание | Компонент |
|---------|----------|-----------|
| `/` | Главная страница со списком новостей | `HomePage` |
| `/news/:id` | Страница одной новости с комментариями | `NewsPage` |
| `/news/create` | Создание новой новости (требуется авторизация, роль `author` или `admin`) | `CreateNewsPage` |
| `/news/:id/edit` | Редактирование новости (требуется авторизация, роль `admin` или автор новости) | `EditNewsPage` |
| `/login` | Страница авторизации | `LoginPage` |
| `/signup` | Страница регистрации | `SignUpPage` |
| `/profile` | Профиль текущего пользователя | `UserProfilePage` |
| `/profile/:userId` | Профиль пользователя по ID | `UserProfilePage` |
| `/admin/users` | Админ-панель управления пользователями (требуется роль `admin`) | `AdminUsersPage` |

## API Endpoints

Все запросы к API выполняются через `axios`. Базовый URL API: `http://localhost:8000`

### Авторизация и сессии

#### POST `/session/` - Авторизация пользователя
**Описание**: Вход в систему по email и паролю. Возвращает JWT токен и refresh токен.

**Используется на странице**: `/login`

**Пример запроса**:
```javascript
POST http://localhost:8000/session/
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

**Ответ**:
- JWT токен в заголовке `x-jwt`
- Refresh токен в теле ответа
- Данные пользователя

#### PUT `/session/` - Обновление токена
**Описание**: Обновление access токена с использованием refresh токена.

**Используется**: Автоматически при истечении access токена (через interceptor axios)

**Пример запроса**:
```javascript
PUT http://localhost:8000/session/
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "refresh_token": "<refresh_token>"
}
```

#### DELETE `/session/` - Выход из системы
**Описание**: Завершение сессии пользователя.

**Используется**: При нажатии кнопки "Выйти" в навигации

**Пример запроса**:
```javascript
DELETE http://localhost:8000/session/
Authorization: Bearer <access_token>
```

#### GET `/session/:userId` - Получение сессий пользователя
**Описание**: Получение списка активных сессий пользователя.

**Используется на странице**: `/profile`

**Пример запроса**:
```javascript
GET http://localhost:8000/session/1
Authorization: Bearer <access_token>
```

#### GET `/session/admin/:userId` - Получение сессий пользователя (для админа)
**Описание**: Получение списка сессий пользователя с refresh токенами (доступно только администраторам).

**Используется на странице**: `/admin/users`

**Пример запроса**:
```javascript
GET http://localhost:8000/session/admin/1
Authorization: Bearer <admin_access_token>
```

### Новости

#### GET `/news/` - Получение списка новостей
**Описание**: Получение списка всех новостей с заголовком, датой, автором.

**Используется на странице**: `/` (главная страница)

**Пример запроса**:
```javascript
GET http://localhost:8000/news/
```

**Ответ**: Массив объектов новостей

#### GET `/news/:id` - Получение одной новости
**Описание**: Получение полной информации о новости по её ID.

**Используется на странице**: `/news/:id`

**Пример запроса**:
```javascript
GET http://localhost:8000/news/1
```

**Ответ**: Объект новости с полным содержимым

#### POST `/news/` - Создание новости
**Описание**: Создание новой новости. Требуется авторизация, роль `author` или `admin`.

**Используется на странице**: `/news/create`

**Пример запроса**:
```javascript
POST http://localhost:8000/news/
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "title": "Заголовок новости",
  "content": {
    "blocks": [...]
  }
}
```

#### PUT `/news/:id` - Обновление новости
**Описание**: Редактирование существующей новости. Требуется авторизация, роль `admin` или автор новости.

**Используется на странице**: `/news/:id/edit`

**Пример запроса**:
```javascript
PUT http://localhost:8000/news/1
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "title": "Обновленный заголовок",
  "content": {
    "blocks": [...]
  }
}
```

#### DELETE `/news/:id` - Удаление новости
**Описание**: Удаление новости. Требуется авторизация, роль `admin` или автор новости.

**Используется на странице**: `/news/:id`

**Пример запроса**:
```javascript
DELETE http://localhost:8000/news/1
Authorization: Bearer <access_token>
```

### Комментарии

#### GET `/comment/news/:newsId` - Получение комментариев к новости
**Описание**: Получение списка всех комментариев к конкретной новости.

**Используется на странице**: `/news/:id`

**Пример запроса**:
```javascript
GET http://localhost:8000/comment/news/1
```

**Ответ**: Массив объектов комментариев

#### POST `/comment/` - Создание комментария
**Описание**: Добавление нового комментария к новости. Требуется авторизация.

**Используется на странице**: `/news/:id` (форма добавления комментария)

**Пример запроса**:
```javascript
POST http://localhost:8000/comment/
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "news_id": 1,
  "text": "Текст комментария"
}
```

#### PUT `/comment/:id` - Обновление комментария
**Описание**: Редактирование существующего комментария. Требуется авторизация, роль `admin` или автор комментария.

**Используется на странице**: `/news/:id` (кнопка редактирования комментария)

**Пример запроса**:
```javascript
PUT http://localhost:8000/comment/1
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "text": "Обновленный текст комментария"
}
```

#### DELETE `/comment/:id` - Удаление комментария
**Описание**: Удаление комментария. Требуется авторизация, роль `admin` или автор комментария.

**Используется на странице**: `/news/:id` (кнопка удаления комментария)

**Пример запроса**:
```javascript
DELETE http://localhost:8000/comment/1
Authorization: Bearer <access_token>
```

### Пользователи

#### POST `/user/` - Регистрация пользователя
**Описание**: Создание нового пользователя.

**Используется на странице**: `/signup`

**Пример запроса**:
```javascript
POST http://localhost:8000/user/
Content-Type: application/json

{
  "email": "newuser@example.com",
  "password": "password123",
  "name": "Имя пользователя"
}
```

#### GET `/user/:userId` - Получение пользователя по ID
**Описание**: Получение информации о пользователе.

**Используется на странице**: `/profile/:userId`

**Пример запроса**:
```javascript
GET http://localhost:8000/user/1
Authorization: Bearer <access_token>
```

#### GET `/user/` - Получение списка всех пользователей
**Описание**: Получение списка всех пользователей. Требуется авторизация, роль `admin`.

**Используется на странице**: `/admin/users`

**Пример запроса**:
```javascript
GET http://localhost:8000/user/
Authorization: Bearer <admin_access_token>
```

#### PUT `/user/:userId` - Обновление пользователя
**Описание**: Редактирование данных пользователя. Требуется авторизация, роль `admin` или сам пользователь.

**Используется на странице**: `/profile`

**Пример запроса**:
```javascript
PUT http://localhost:8000/user/1
Content-Type: application/json
Authorization: Bearer <access_token>

{
  "name": "Новое имя",
  "email": "newemail@example.com"
}
```

#### DELETE `/user/:userId` - Удаление пользователя
**Описание**: Удаление пользователя. Требуется авторизация, роль `admin`.

**Используется на странице**: `/admin/users`

**Пример запроса**:
```javascript
DELETE http://localhost:8000/user/1
Authorization: Bearer <admin_access_token>
```

## Работа с авторизацией

### Хранение токенов

Приложение использует `localStorage` для хранения:
- `token` - JWT access токен
- `refreshToken` - Refresh токен для обновления access токена
- `user` - Данные текущего пользователя
- `userId` - ID текущего пользователя
- `session` - Данные сессии

### Автоматическое добавление токена к запросам

Все запросы к API автоматически дополняются заголовком `Authorization: Bearer <token>` через axios interceptor, если токен присутствует в `localStorage`.

### Обновление токена

При получении ошибки 401 (Unauthorized) приложение автоматически пытается обновить access токен с использованием refresh токена. Если обновление не удалось, пользователь перенаправляется на страницу авторизации.

## Роли и права доступа

Приложение поддерживает следующие роли пользователей:

- **`user`** - Обычный пользователь
    - Просмотр новостей и комментариев
    - Создание комментариев
    - Редактирование и удаление своих комментариев

- **`author`** - Автор
    - Все права обычного пользователя
    - Создание новостей
    - Редактирование и удаление своих новостей

- **`admin`** - Администратор
    - Все права автора
    - Редактирование и удаление любых новостей
    - Удаление любых комментариев
    - Управление пользователями
    - Просмотр всех сессий пользователей

Элементы интерфейса (кнопки, ссылки) отображаются или скрываются в зависимости от роли пользователя, полученной из JWT токена.


## Примечания

- Токены автоматически добавляются к запросам через axios interceptors
- При истечении access токена происходит автоматическое обновление через refresh токен

